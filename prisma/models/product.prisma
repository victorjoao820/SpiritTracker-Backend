model Product {
  id          String   @id @default(cuid())
  userId      String
  name        String
  description String?
  productCode String?  // SKU or product code
  category    String?  // Whiskey type: bourbon, rye, scotch, etc.
  abv         Decimal? @db.Decimal(4, 2)  // Alcohol by volume percentage
  status      ProductStatus @default(ACTIVE)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  user             User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  containers       Container[]
  distillations Distillation[]
  transactions     Transaction[]
  batchingRuns    BatchingRun[]
  bottlingRuns     BottlingRun[]
  finishedGoods    FinishedGoods[]
  bailmentDepletions BailmentDepletion[]

  @@map("products")
}
model ContainerKind {
  id          String   @id @default(cuid())
  userId      String
  name        String
  type        String
  tareWeight        Decimal?  @db.Decimal(10, 2)  // Weight of empty container
  capacityGallons         Decimal?  @db.Decimal(10, 2)  // Weight gallons of full contents only
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations

  user             User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  containers Container[]
  @@map("container_kinds")
}


model Container {
  id                String    @id @default(cuid())
  userId            String
  containerKindId   String?
  productId         String?
  name              String?   // Container name/identifier
  type              String?   // 'barrel', 'drum', 'tank', 'tote', 'still', 'fermenter'
  status            ContainerStatus @default(EMPTY)  // Operational status
  account           String?   // Storage, Production, Processing
  proof             Decimal?  @db.Decimal(5, 2)
  tareWeight        Decimal?  @db.Decimal(10, 2)  // Weight of empty container
  netWeight         Decimal?  @db.Decimal(10, 2)  // Weight of contents only
  temperatureFahrenheit Decimal? @db.Decimal(5, 2)
  fillDate          DateTime?
  location          String?   // Physical location/warehouse
  notes             String?   // Additional information
  updatedAt         DateTime  @updatedAt

  // Relations
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  containerKind ContainerKind? @relation(fields: [containerKindId], references: [id], onDelete: SetNull)
  product      Product?      @relation(fields: [productId], references: [id], onDelete: SetNull)
  transactions Transaction[]
  transfers    Transfer[]
  distillations Distillation[]


  @@map("containers")
}

model Fermenter {
  id              String    @id @default(cuid())
  userId          String
  name            String
  capacityGallons Decimal?   @db.Decimal(10, 2)
  currentVolumeGallons Decimal? @db.Decimal(10, 2)
  proof           Decimal?   @db.Decimal(5, 2)
  status          BatchStatus @default(IN_PROGRESS)
  notes           String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  fermentations Fermentation[]
}

model Fermentation {
  id              String    @id @default(cuid())
  userId          String
  // productId       String?
  batchName       String?
  fermenterId     String?
  mashBill        String? 
  startDate       DateTime?
  endDate         DateTime?
  volumeGallons   Decimal?   @db.Decimal(10, 2)
  startSG         Decimal?   @db.Decimal(5, 2)
  finalFG         Decimal?   @db.Decimal(5, 2)
  status          BatchStatus @default(IN_PROGRESS)
  ingredient      String?
  notes           String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  user         User?          @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions Transaction[]
  fermenter       Fermenter? @relation(fields: [fermenterId], references: [id], onDelete: SetNull)
  distillations Distillation[]

  @@map("fermentations")
}

model Distillation {
  id              String    @id @default(cuid())
  userId          String
  fermentationId  String?
  productId       String?
  batchType       BatchType
  batchName       String?
  startDate       DateTime?
  endDate         DateTime?
  chargeProof     Decimal?   @db.Decimal(5, 2)
  yieldProof      Decimal?   @db.Decimal(5, 2)
  chargeTemperature Decimal? @db.Decimal(5, 2)
  yieldTemperature Decimal? @db.Decimal(5, 2)

  chargeVolumeGallons Decimal?   @db.Decimal(10, 2)
  yieldVolumeGallons Decimal?   @db.Decimal(10, 2)

  storeYieldContainer String?
  status          BatchStatus @default(IN_PROGRESS)
  notes           String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  product      Product?      @relation(fields: [productId], references: [id], onDelete: SetNull)
  fermentation Fermentation? @relation(fields: [fermentationId], references: [id], onDelete: SetNull)
  container    Container?    @relation(fields: [storeYieldContainer], references: [id], onDelete: SetNull)

  @@map("distillations")

}


model Transaction {
  id                String    @id @default(cuid())
  userId            String
  transactionType   TransactionType
  containerId       String?
  fermentationId String?
  productId         String?
  volumeGallons     Decimal?  @db.Decimal(10, 2)
  proofGallons      Decimal?  @db.Decimal(10, 2)
  proof             Decimal?  @db.Decimal(5, 2)
  temperatureFahrenheit Decimal? @db.Decimal(5, 2)
  notes             String?
  metadata          Json?     // For additional transaction-specific data
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  container       Container?      @relation(fields: [containerId], references: [id], onDelete: SetNull)
  fermentation Fermentation? @relation(fields: [fermentationId], references: [id], onDelete: SetNull)
  product         Product?        @relation(fields: [productId], references: [id], onDelete: SetNull)

  @@map("transactions")
}

// Barrel Management Models
model Barrel {
  id                String    @id @default(cuid())
  userId            String
  barrelNumber      String    @unique
  barrelType        String    // 'new_oak', 'used_oak', 'charred', 'toasted'
  charLevel         Int?      // 1-4 char level
  toastLevel        Int?      // 1-4 toast level
  capacityGallons   Decimal   @db.Decimal(10, 2)
  currentVolumeGallons Decimal? @db.Decimal(10, 2)
  proof             Decimal?  @db.Decimal(5, 2)
  temperatureFahrenheit Decimal? @db.Decimal(5, 2)
  fillDate          DateTime?
  dumpDate          DateTime?
  ageYears          Decimal?  @db.Decimal(4, 2)
  location          String?   // rackhouse location
  status            BarrelStatus @default(FILLED)
  notes             String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  barrelLogs   BarrelLog[]
  transfers    Transfer[]

  @@map("barrels")
}

model BarrelLog {
  id                String    @id @default(cuid())
  userId            String
  barrelId          String
  logType           BarrelLogType
  volumeGallons     Decimal?  @db.Decimal(10, 2)
  proof             Decimal?  @db.Decimal(5, 2)
  temperatureFahrenheit Decimal? @db.Decimal(5, 2)
  notes             String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  barrel  Barrel  @relation(fields: [barrelId], references: [id], onDelete: Cascade)

  @@map("barrel_logs")
}

// Processing Models
model BatchingRun {
  id                String    @id @default(cuid())
  userId            String
  batchNumber       String
  productId         String?
  batchType         BatchingType
  startDate         DateTime
  endDate           DateTime?
  volumeGallons     Decimal?  @db.Decimal(10, 2)
  proof             Decimal?  @db.Decimal(5, 2)
  temperatureFahrenheit Decimal? @db.Decimal(5, 2)
  status            BatchingStatus @default(IN_PROGRESS)
  notes             String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  product      Product?      @relation(fields: [productId], references: [id], onDelete: SetNull)
  bottlingRuns BottlingRun[]

  @@map("batching_runs")
}

model BottlingRun {
  id                String    @id @default(cuid())
  userId            String
  batchingRunId     String?
  batchNumber       String
  productId         String?
  bottleSize        Decimal   @db.Decimal(8, 2) // in ounces
  bottlesProduced   Int
  volumeGallons     Decimal   @db.Decimal(10, 2)
  proof             Decimal   @db.Decimal(5, 2)
  startDate         DateTime
  endDate           DateTime?
  status            BottlingStatus @default(IN_PROGRESS)
  notes             String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  batchingRun  BatchingRun?  @relation(fields: [batchingRunId], references: [id], onDelete: SetNull)
  product      Product?      @relation(fields: [productId], references: [id], onDelete: SetNull)

  @@map("bottling_runs")
}

// Transfer In Bond (TIB) Models
model Transfer {
  id                String    @id @default(cuid())
  userId            String
  transferNumber    String
  transferType      TransferType
  direction         TransferDirection
  barrelId          String?
  containerId       String?
  volumeGallons     Decimal   @db.Decimal(10, 2)
  proof             Decimal   @db.Decimal(5, 2)
  temperatureFahrenheit Decimal? @db.Decimal(5, 2)
  transferDate      DateTime
  destination       String?   // destination facility
  carrier           String?   // transportation company
  sealNumber        String?   // TTB seal number
  status            TransferStatus @default(PENDING)
  notes             String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  barrel  Barrel? @relation(fields: [barrelId], references: [id], onDelete: SetNull)
  container Container? @relation(fields: [containerId], references: [id], onDelete: SetNull)

  @@map("transfers")
}

// Finished Goods Models
model FinishedGoods {
  id                String    @id @default(cuid())
  userId            String
  productId         String?
  batchNumber       String?
  bottleSize        Decimal   @db.Decimal(8, 2) // in ounces
  quantity          Int
  proof             Decimal   @db.Decimal(5, 2)
  location          String?   // warehouse location
  status            FinishedGoodsStatus @default(IN_WAREHOUSE)
  receivedDate      DateTime?
  shippedDate       DateTime?
  notes             String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product? @relation(fields: [productId], references: [id], onDelete: SetNull)
  bailmentDepletions BailmentDepletion[]

  @@map("finished_goods")
}

model BailmentDepletion {
  id                String    @id @default(cuid())
  userId            String
  finishedGoodsId   String?
  productId         String?
  depletionType     DepletionType
  quantity          Int
  depletionDate     DateTime
  reason            String?
  notes             String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  finishedGoods FinishedGoods? @relation(fields: [finishedGoodsId], references: [id], onDelete: SetNull)
  product       Product?       @relation(fields: [productId], references: [id], onDelete: SetNull)

  @@map("bailment_depletions")
}

// Tank Management Models
model Tank {
  id                String    @id @default(cuid())
  userId            String
  tankNumber        String
  tankType          TankType
  capacityGallons   Decimal   @db.Decimal(10, 2)
  currentVolumeGallons Decimal? @db.Decimal(10, 2)
  proof             Decimal?  @db.Decimal(5, 2)
  temperatureFahrenheit Decimal? @db.Decimal(5, 2)
  status            TankStatus @default(EMPTY)
  location          String?
  notes             String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  user    User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  tankLogs TankLog[]

  @@map("tanks")
}

model TankLog {
  id                String    @id @default(cuid())
  userId            String
  tankId            String
  logType           TankLogType
  volumeGallons     Decimal?  @db.Decimal(10, 2)
  proof             Decimal?  @db.Decimal(5, 2)
  temperatureFahrenheit Decimal? @db.Decimal(5, 2)
  action            String?   // 'fill', 'empty', 'transfer', 'filter', 'adjust'
  notes             String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  tank Tank @relation(fields: [tankId], references: [id], onDelete: Cascade)

  @@map("tank_logs")
}

// Reports Models
model TTBReport {
  id                String    @id @default(cuid())
  userId            String
  reportType        TTBReportType
  reportPeriod      String    // e.g., "2024-01"
  reportDate        DateTime
  status            TTBReportStatus @default(DRAFT)
  submittedDate     DateTime?
  ttbApprovalDate  DateTime?
  notes             String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("ttb_reports")
}

enum ContainerStatus {
  EMPTY
  FILLED
  IN_USE
  MAINTENANCE
  OUT_OF_SERVICE
  DAMAGED
}

enum ProductStatus {
  ACTIVE
  INACTIVE
  DISCONTINUED
}

enum BatchType {
  FERMENTATION
  DISTILLATION
}

enum BatchStatus {
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum TransactionType {
  CREATE_EMPTY_CONTAINER
  CREATE_FILLED_CONTAINER
  DELETE_EMPTY_CONTAINER
  DELETE_FILLED_CONTAINER
  EDIT_EMPTY_DATA_CORRECTION
  EDIT_FILL_DATA_CORRECTION
  EDIT_FILL_FROM_EMPTY
  EDIT_EMPTY_FROM_FILLED
  REFILL_CONTAINER
  TRANSFER_IN
  TRANSFER_OUT
  PRODUCTION
  DISTILLATION_FINISH
  FERMENTATION_FINISH
  ADJUST_CONTAINER_ADD
  ADJUST_CONTAINER_REMOVE
  PROOF_DOWN
  BOTTLE_KEEP
  BOTTLE_EMPTY
  BOTTLING_GAIN
  BOTTLING_LOSS
  DELETE_PRODUCT
  DELETE_PRODUCTION_BATCH
  CHANGE_ACCOUNT
}

// Barrel Management Enums
enum BarrelStatus {
  EMPTY
  FILLED
  DUMPED
  TRANSFERRED
  DAMAGED
}

enum BarrelLogType {
  FILL
  DUMP
  TRANSFER
  SAMPLING
  INSPECTION
  MAINTENANCE
  ADJUSTMENT
}

// Processing Enums
enum BatchingType {
  BLENDING
  FILTERING
  CHILL_FILTERING
  CARBON_FILTERING
  FINISHING
}

enum BatchingStatus {
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum BottlingStatus {
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

// Transfer In Bond Enums
enum TransferType {
  BARREL
  CONTAINER
  TOTE
  TANKER
}

enum TransferDirection {
  INBOUND
  OUTBOUND
}

enum TransferStatus {
  PENDING
  IN_TRANSIT
  DELIVERED
  CANCELLED
}

// Finished Goods Enums
enum FinishedGoodsStatus {
  IN_WAREHOUSE
  SHIPPED
  RETURNED
  DAMAGED
}

enum DepletionType {
  SALE
  SAMPLE
  DAMAGE
  THEFT
  RETURN
  ADJUSTMENT
}

// Tank Management Enums
enum TankType {
  STORAGE
  BLENDING
  FINISHING
  FILTERING
  TEMPORARY
}

enum TankStatus {
  EMPTY
  FILLED
  IN_USE
  MAINTENANCE
  OUT_OF_SERVICE
}

enum TankLogType {
  FILL
  EMPTY
  TRANSFER
  FILTER
  ADJUST
  MAINTENANCE
  SAMPLING
}

// TTB Reports Enums
enum TTBReportType {
  MONTHLY_PRODUCTION
  MONTHLY_INVENTORY
  ANNUAL_PRODUCTION
  SPECIAL_REPORT
}

enum TTBReportStatus {
  DRAFT
  SUBMITTED
  APPROVED
  REJECTED
  AMENDED
}
